<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>Похожие решения</title>
<style type="text/css">
* {padding-top:0;margin-top:0;border-top:0;}
.Common {background-color: #ff9999;}
tr, td {vertical-align: top; border-left: 1px solid #ddd;border-bottom: 1px solid #ddd;}
th {background-color: #ddd} 
</style>
</head>
<body>
<pre>
<table valign="top">
<tr><th>2</th><th>5</th></tr><tr><td><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Collections</span><span class="Common">.</span><span class="Common">Generic</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Drawing</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Linq</span><span class="Common">;</span><span class="Common">

</span><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">;</span><span class="Common">

</span><span class="Common">public</span><span class="Common"> </span><span class="Common">class</span><span class="Common"> </span><span class="Common">GameState</span><span class="Common">
</span><span class="Common">{</span><span class="Common">
	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">const</span><span class="Common"> </span><span class="Common">int</span><span class="Specific"> </span><span class="Specific">ElementSize</span><span class="Specific"> </span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">32</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">List</span><span class="Common"><</span><span class="Common">CreatureAnimation</span><span class="Common">></span><span class="Common"> </span><span class="Common">Animations</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">void</span><span class="Common"> </span><span class="Common">BeginAct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">Animations</span><span class="Common">.</span><span class="Common">Clear</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">x</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">x</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">y</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">y</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">{</span><span class="Common">
			</span><span class="Common">var</span><span class="Common"> </span><span class="Common">creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">Map</span><span class="Common">[</span><span class="Specific">x</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">y</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">null</span><span class="Common">)</span><span class="Common"> </span><span class="Common">continue</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">command</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">creature</span><span class="Common">.</span><span class="Common">Act</span><span class="Common">(</span><span class="Specific">x</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">y</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

			</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Specific">x</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">command</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">0</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Specific"> </span><span class="Specific">x</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">command</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common"> </span><span class="Common">></span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Specific"> </span><span class="Specific">y</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">command</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">0</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Specific">
			    </span><span class="Specific">y</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">command</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common"> </span><span class="Common">></span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Specific">$</span><span class="Specific">"</span><span class="Specific">The</span><span class="Specific"> </span><span class="Specific">object</span><span class="Specific"> </span><span class="Specific">{</span><span class="Specific">creature</span><span class="Specific">.</span><span class="Specific">GetType</span><span class="Specific">(</span><span class="Common">)</span><span class="Specific">}</span><span class="Specific"> </span><span class="Specific">falls</span><span class="Specific"> </span><span class="Specific">out</span><span class="Specific"> </span><span class="Specific">of</span><span class="Specific"> </span><span class="Specific">the</span><span class="Specific"> </span><span class="Specific">game</span><span class="Specific"> </span><span class="Specific">field</span><span class="Specific">"</span><span class="Specific">)</span><span class="Common">;</span><span class="Common">

			</span><span class="Common">Animations</span><span class="Common">.</span><span class="Common">Add</span><span class="Common">(</span><span class="Common">
				</span><span class="Common">new</span><span class="Common"> </span><span class="Common">CreatureAnimation</span><span class="Common">
				</span><span class="Common">{</span><span class="Common">
					</span><span class="Common">Command</span><span class="Common"> </span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">command</span><span class="Common">,</span><span class="Common">
					</span><span class="Common">Creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">creature</span><span class="Common">,</span><span class="Common">
					</span><span class="Common">Location</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Point</span><span class="Common">(</span><span class="Specific">x</span><span class="Specific"> </span><span class="Common">*</span><span class="Specific"> </span><span class="Specific">ElementSize</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">y</span><span class="Specific"> </span><span class="Common">*</span><span class="Specific"> </span><span class="Specific">ElementSize</span><span class="Common">)</span><span class="Common">,</span><span class="Common">
					</span><span class="Common">TargetLogicalLocation</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Point</span><span class="Common">(</span><span class="Specific">x</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">command</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">y</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">command</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">}</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Common">

		</span><span class="Common">Animations</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Animations</span><span class="Common">.</span><span class="Common">OrderByDescending</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Creature</span><span class="Common">.</span><span class="Common">GetDrawingPriority</span><span class="Common">(</span><span class="Common">)</span><span class="Common">)</span><span class="Common">.</span><span class="Common">ToList</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">

	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">void</span><span class="Common"> </span><span class="Common">EndAct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">creaturesPerLocation</span><span class="Common"> </span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">GetCandidatesPerLocation</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">x</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">x</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">y</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">y</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">Game</span><span class="Common">.</span><span class="Common">Map</span><span class="Common">[</span><span class="Specific">x</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">y</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">SelectWinnerCandidatePerLocation</span><span class="Common">(</span><span class="Common">creaturesPerLocation</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">x</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">y</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">

	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Specific"> </span><span class="Specific">SelectWinnerCandidatePerLocation</span><span class="Common">(</span><span class="Common">List</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">[</span><span class="Common">,</span><span class="Common">]</span><span class="Common"> </span><span class="Common">creatures</span><span class="Common">,</span><span class="Common"> </span><span class="Common">int</span><span class="Specific"> </span><span class="Specific">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">int</span><span class="Specific"> </span><span class="Specific">y</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">candidates</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">creatures</span><span class="Common">[</span><span class="Specific">x</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">y</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">aliveCandidates</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">candidates</span><span class="Common">.</span><span class="Common">ToList</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">foreach</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">candidate</span><span class="Common"> </span><span class="Common">in</span><span class="Common"> </span><span class="Common">candidates</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">foreach</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">rival</span><span class="Common"> </span><span class="Common">in</span><span class="Common"> </span><span class="Common">candidates</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">rival</span><span class="Common"> </span><span class="Common">!</span><span class="Common">=</span><span class="Common"> </span><span class="Common">candidate</span><span class="Common"> </span><span class="Common">&</span><span class="Common">&</span><span class="Common"> </span><span class="Common">candidate</span><span class="Common">.</span><span class="Common">DeadInConflict</span><span class="Common">(</span><span class="Common">rival</span><span class="Common">)</span><span class="Common">)</span><span class="Specific">
				</span><span class="Specific">aliveCandidates</span><span class="Common">.</span><span class="Common">Remove</span><span class="Common">(</span><span class="Common">candidate</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Specific">aliveCandidates</span><span class="Common">.</span><span class="Common">Count</span><span class="Common"> </span><span class="Common">></span><span class="Common"> </span><span class="Common">1</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Specific">
				</span><span class="Specific">$</span><span class="Specific">"</span><span class="Specific">Creatures</span><span class="Specific"> </span><span class="Specific">{</span><span class="Specific">aliveCandidates</span><span class="Specific">[</span><span class="Specific">0</span><span class="Specific">]</span><span class="Specific">.</span><span class="Specific">GetType</span><span class="Specific">(</span><span class="Common">)</span><span class="Specific">.</span><span class="Specific">Name</span><span class="Specific">}</span><span class="Specific"> </span><span class="Specific">and</span><span class="Specific"> </span><span class="Specific">{</span><span class="Specific">aliveCandidates</span><span class="Specific">[</span><span class="Specific">1</span><span class="Specific">]</span><span class="Specific">.</span><span class="Specific">GetType</span><span class="Specific">(</span><span class="Specific">)</span><span class="Specific">.</span><span class="Specific">Name</span><span class="Specific">}</span><span class="Specific"> </span><span class="Specific">claimed</span><span class="Specific"> </span><span class="Specific">the</span><span class="Specific"> </span><span class="Specific">same</span><span class="Specific"> </span><span class="Specific">map</span><span class="Specific"> </span><span class="Specific">cell</span><span class="Specific">"</span><span class="Specific">)</span><span class="Common">;</span><span class="Common">

		</span><span class="Common">return</span><span class="Specific"> </span><span class="Specific">aliveCandidates</span><span class="Common">.</span><span class="Common">FirstOrDefault</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">

	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">List</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">[</span><span class="Common">,</span><span class="Common">]</span><span class="Specific"> </span><span class="Specific">GetCandidatesPerLocation</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">creatures</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">List</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">[</span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">,</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">x</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">x</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">y</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">y</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">creatures</span><span class="Common">[</span><span class="Specific">x</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">y</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">List</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">foreach</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">e</span><span class="Common"> </span><span class="Common">in</span><span class="Common"> </span><span class="Common">Animations</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">{</span><span class="Common">
			</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">x</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">e</span><span class="Common">.</span><span class="Common">TargetLogicalLocation</span><span class="Common">.</span><span class="Common">X</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">y</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">e</span><span class="Common">.</span><span class="Common">TargetLogicalLocation</span><span class="Common">.</span><span class="Common">Y</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">nextCreature</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">e</span><span class="Common">.</span><span class="Common">Command</span><span class="Common">.</span><span class="Common">TransformTo</span><span class="Common"> </span><span class="Common">?</span><span class="Common">?</span><span class="Common"> </span><span class="Common">e</span><span class="Common">.</span><span class="Common">Creature</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">creatures</span><span class="Common">[</span><span class="Specific">x</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">y</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Add</span><span class="Common">(</span><span class="Specific">nextCreature</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Common">

		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">creatures</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">
</span><span class="Common">}</span></td><td><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Collections</span><span class="Common">.</span><span class="Common">Generic</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Drawing</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Linq</span><span class="Common">;</span><span class="Common">

</span><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">;</span><span class="Common">

</span><span class="Common">public</span><span class="Common"> </span><span class="Common">class</span><span class="Common"> </span><span class="Common">GameState</span><span class="Common">
</span><span class="Common">{</span><span class="Common">
	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">const</span><span class="Common"> </span><span class="Common">int</span><span class="Specific"> </span><span class="Specific">SizeOfElement</span><span class="Specific"> </span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">1</span><span class="Specific"> </span><span class="Specific"><</span><span class="Specific"><</span><span class="Specific"> </span><span class="Specific">5</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">List</span><span class="Common"><</span><span class="Common">CreatureAnimation</span><span class="Common">></span><span class="Common"> </span><span class="Common">Animations</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">void</span><span class="Common"> </span><span class="Common">BeginAct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">Animations</span><span class="Common">.</span><span class="Common">Clear</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">i</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">i</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">i</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">j</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">j</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">j</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">{</span><span class="Common">
			</span><span class="Common">var</span><span class="Common"> </span><span class="Common">creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">Map</span><span class="Common">[</span><span class="Specific">i</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">j</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">null</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">continue</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">cmd</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">creature</span><span class="Common">.</span><span class="Common">Act</span><span class="Common">(</span><span class="Specific">i</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">j</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

			</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Specific">i</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">cmd</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">0</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Specific"> </span><span class="Specific">i</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">cmd</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common"> </span><span class="Common">></span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Specific"> </span><span class="Specific">j</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">cmd</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">0</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Specific">
			    </span><span class="Specific">j</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">cmd</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common"> </span><span class="Common">></span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

			</span><span class="Common">Animations</span><span class="Common">.</span><span class="Common">Add</span><span class="Common">(</span><span class="Common">
				</span><span class="Common">new</span><span class="Common"> </span><span class="Common">CreatureAnimation</span><span class="Common">
				</span><span class="Common">{</span><span class="Common">
					</span><span class="Common">Command</span><span class="Common"> </span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">cmd</span><span class="Common">,</span><span class="Common">
					</span><span class="Common">Creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">creature</span><span class="Common">,</span><span class="Common">
					</span><span class="Common">Location</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Point</span><span class="Common">(</span><span class="Specific">i</span><span class="Specific"> </span><span class="Common">*</span><span class="Specific"> </span><span class="Specific">SizeOfElement</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">j</span><span class="Specific"> </span><span class="Common">*</span><span class="Specific"> </span><span class="Specific">SizeOfElement</span><span class="Common">)</span><span class="Common">,</span><span class="Common">
					</span><span class="Common">TargetLogicalLocation</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Point</span><span class="Common">(</span><span class="Specific">i</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">cmd</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">j</span><span class="Specific"> </span><span class="Common">+</span><span class="Specific"> </span><span class="Specific">cmd</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">}</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Common">

		</span><span class="Common">Animations</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Animations</span><span class="Common">
			</span><span class="Common">.</span><span class="Common">OrderByDescending</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Creature</span><span class="Common">.</span><span class="Common">GetDrawingPriority</span><span class="Common">(</span><span class="Common">)</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">.</span><span class="Common">ToList</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">

	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">void</span><span class="Common"> </span><span class="Common">EndAct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">creaturesPerLocation</span><span class="Common"> </span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">GetCandidates</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">i</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">i</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">i</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">j</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">j</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">j</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Specific">
			</span><span class="Specific">{</span><span class="Specific">
				</span><span class="Common">Game</span><span class="Common">.</span><span class="Common">Map</span><span class="Common">[</span><span class="Specific">i</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">j</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">SelectWinnerCandidate</span><span class="Common">(</span><span class="Common">creaturesPerLocation</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">i</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">j</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">}</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">
	</span><span class="Specific">}</span><span class="Specific">

	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Specific"> </span><span class="Specific">SelectWinnerCandidate</span><span class="Common">(</span><span class="Common">List</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">[</span><span class="Common">,</span><span class="Common">]</span><span class="Common"> </span><span class="Common">creatures</span><span class="Common">,</span><span class="Common"> </span><span class="Common">int</span><span class="Specific"> </span><span class="Specific">i</span><span class="Common">,</span><span class="Common"> </span><span class="Common">int</span><span class="Specific"> </span><span class="Specific">j</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">candidates</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">creatures</span><span class="Common">[</span><span class="Specific">i</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">j</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">alive</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">candidates</span><span class="Common">.</span><span class="Common">ToList</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">foreach</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">candidate</span><span class="Common"> </span><span class="Common">in</span><span class="Common"> </span><span class="Common">candidates</span><span class="Common">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">foreach</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">rival</span><span class="Common"> </span><span class="Common">in</span><span class="Common"> </span><span class="Common">candidates</span><span class="Common">)</span><span class="Specific">
			</span><span class="Specific">{</span><span class="Specific">
				</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">rival</span><span class="Common"> </span><span class="Common">!</span><span class="Common">=</span><span class="Common"> </span><span class="Common">candidate</span><span class="Common"> </span><span class="Common">&</span><span class="Common">&</span><span class="Common"> </span><span class="Common">candidate</span><span class="Common">.</span><span class="Common">DeadInConflict</span><span class="Common">(</span><span class="Common">rival</span><span class="Common">)</span><span class="Common">)</span><span class="Specific">
				</span><span class="Specific">{</span><span class="Specific">
					</span><span class="Specific">alive</span><span class="Common">.</span><span class="Common">Remove</span><span class="Common">(</span><span class="Common">candidate</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
				</span><span class="Specific">}</span><span class="Specific">
			</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Specific">alive</span><span class="Common">.</span><span class="Common">Count</span><span class="Common"> </span><span class="Common">></span><span class="Common"> </span><span class="Common">1</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

		</span><span class="Common">return</span><span class="Specific"> </span><span class="Specific">alive</span><span class="Common">.</span><span class="Common">FirstOrDefault</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">

	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">List</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">[</span><span class="Common">,</span><span class="Common">]</span><span class="Specific"> </span><span class="Specific">GetCandidates</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">creatures</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">List</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">[</span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">,</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">i</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">i</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">i</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">j</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">j</span><span class="Specific"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">;</span><span class="Specific"> </span><span class="Specific">j</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Specific">
			</span><span class="Specific">{</span><span class="Specific">
				</span><span class="Common">creatures</span><span class="Common">[</span><span class="Specific">i</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">j</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">List</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
			</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">foreach</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">e</span><span class="Common"> </span><span class="Common">in</span><span class="Common"> </span><span class="Common">Animations</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">{</span><span class="Common">
			</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">i</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">e</span><span class="Common">.</span><span class="Common">TargetLogicalLocation</span><span class="Common">.</span><span class="Common">X</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">j</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">e</span><span class="Common">.</span><span class="Common">TargetLogicalLocation</span><span class="Common">.</span><span class="Common">Y</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">var</span><span class="Specific"> </span><span class="Specific">next</span><span class="Specific"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">e</span><span class="Common">.</span><span class="Common">Command</span><span class="Common">.</span><span class="Common">TransformTo</span><span class="Common"> </span><span class="Common">?</span><span class="Common">?</span><span class="Common"> </span><span class="Common">e</span><span class="Common">.</span><span class="Common">Creature</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">creatures</span><span class="Common">[</span><span class="Specific">i</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">j</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Add</span><span class="Common">(</span><span class="Specific">next</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Common">

		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">creatures</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">
</span><span class="Common">}</span></td></tr><tr><th>6</th><th>7</th></tr><tr><td><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Collections</span><span class="Common">.</span><span class="Common">Generic</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Linq</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Reflection</span><span class="Common">;</span><span class="Common">

</span><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">;</span><span class="Common">

</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">class</span><span class="Common"> </span><span class="Common">CreatureMapCreator</span><span class="Common">
</span><span class="Common">{</span><span class="Common">
	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">readonly</span><span class="Common"> </span><span class="Common">Dictionary</span><span class="Common"><</span><span class="Common">string</span><span class="Common">,</span><span class="Common"> </span><span class="Common">Func</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">></span><span class="Common"> </span><span class="Common">factory</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">,</span><span class="Common">]</span><span class="Common"> </span><span class="Common">CreateMap</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">map</span><span class="Common">,</span><span class="Common"> </span><span class="Common">string</span><span class="Common"> </span><span class="Common">separator</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">"</span><span class="Common">\</span><span class="Common">r</span><span class="Common">\</span><span class="Common">n</span><span class="Common">"</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">rows</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">map</span><span class="Common">.</span><span class="Common">Split</span><span class="Common">(</span><span class="Common">new</span><span class="Common">[</span><span class="Common">]</span><span class="Common"> </span><span class="Common">{</span><span class="Common">separator</span><span class="Common">}</span><span class="Common">,</span><span class="Common"> </span><span class="Common">StringSplitOptions</span><span class="Common">.</span><span class="Common">RemoveEmptyEntries</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Select</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Distinct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Count</span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">!</span><span class="Common">=</span><span class="Common"> </span><span class="Common">1</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Wrong</span><span class="Common"> </span><span class="Common">test</span><span class="Common"> </span><span class="Common">map</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">map</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">result</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">,</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">result</span><span class="Common">[</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">y</span><span class="Common">]</span><span class="Common">[</span><span class="Common">x</span><span class="Common">]</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">result</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">

	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Specific">
		</span><span class="Specific">/</span><span class="Specific">/</span><span class="Specific"> </span><span class="Specific">Какой</span><span class="Specific">-</span><span class="Specific">то</span><span class="Specific"> </span><span class="Specific">комментарий</span><span class="Specific">
		</span><span class="Specific">/</span><span class="Specific">/</span><span class="Specific"> </span><span class="Specific">И</span><span class="Specific"> </span><span class="Specific">ещё</span><span class="Specific">.</span><span class="Specific">.</span><span class="Specific">
		</span><span class="Specific">/</span><span class="Specific">/</span><span class="Specific"> </span><span class="Specific">И</span><span class="Specific"> </span><span class="Specific">ещё</span><span class="Specific"> </span><span class="Specific">комментарий</span><span class="Specific">
		</span><span class="Specific">/</span><span class="Specific">/</span><span class="Specific"> </span><span class="Specific">Пожалуй</span><span class="Specific">,</span><span class="Specific"> </span><span class="Specific">перепишу</span><span class="Specific"> </span><span class="Specific">один</span><span class="Specific"> </span><span class="Specific">метод</span><span class="Specific">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Specific">!</span><span class="Common">factory</span><span class="Common">.</span><span class="Common">ContainsKey</span><span class="Common">(</span><span class="Common">name</span><span class="Common">)</span><span class="Common">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">var</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Assembly</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">GetExecutingAssembly</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">GetTypes</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">FirstOrDefault</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Name</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">null</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Can</span><span class="Common">'</span><span class="Common">t</span><span class="Common"> </span><span class="Common">find</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">name</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">(</span><span class="Common">ICreature</span><span class="Common">)</span><span class="Common"> </span><span class="Common">Activator</span><span class="Common">.</span><span class="Common">CreateInstance</span><span class="Common">(</span><span class="Common">type</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">


	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">char</span><span class="Common"> </span><span class="Common">c</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Specific">
		</span><span class="Specific">List</span><span class="Specific"><</span><span class="Specific">string</span><span class="Specific">></span><span class="Specific"> </span><span class="Specific">names</span><span class="Specific"> </span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">new</span><span class="Specific"> </span><span class="Specific">List</span><span class="Specific"><</span><span class="Specific">string</span><span class="Specific">></span><span class="Specific"> </span><span class="Common">{</span><span class="Common">"</span><span class="Common">Player</span><span class="Common">"</span><span class="Specific">,</span><span class="Specific"> </span><span class="Common">"</span><span class="Common">Terrain</span><span class="Common">"</span><span class="Specific">,</span><span class="Specific"> </span><span class="Common">"</span><span class="Common">Gold</span><span class="Common">"</span><span class="Specific">,</span><span class="Specific"> </span><span class="Specific">"</span><span class="Specific">Sack</span><span class="Specific">"</span><span class="Specific">,</span><span class="Specific"> </span><span class="Specific">"</span><span class="Specific">Monster</span><span class="Specific">"</span><span class="Common">}</span><span class="Specific">;</span><span class="Specific">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">c</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">'</span><span class="Common"> </span><span class="Common">'</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">{</span><span class="Common">
			</span><span class="Common">return</span><span class="Specific"> </span><span class="Specific">null</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Specific">

		</span><span class="Specific">var</span><span class="Specific"> </span><span class="Specific">name</span><span class="Specific"> </span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">names</span><span class="Specific">.</span><span class="Specific">FirstOrDefault</span><span class="Specific">(</span><span class="Specific">s</span><span class="Specific"> </span><span class="Common">=</span><span class="Specific">></span><span class="Specific"> </span><span class="Specific">s</span><span class="Specific">.</span><span class="Specific">StartsWith</span><span class="Common">(</span><span class="Specific">new</span><span class="Specific"> </span><span class="Specific">string</span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific">,</span><span class="Specific"> </span><span class="Specific">1</span><span class="Common">)</span><span class="Specific">)</span><span class="Specific">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Specific">name</span><span class="Specific"> </span><span class="Common">=</span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">null</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">{</span><span class="Common">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">wrong</span><span class="Common"> </span><span class="Common">character</span><span class="Common"> </span><span class="Common">for</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">{</span><span class="Common">c</span><span class="Common">}</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Specific">

		</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Specific">(</span><span class="Specific">name</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
	</span><span class="Common">}</span><span class="Specific">
</span><span class="Specific">}</span></td><td><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Collections</span><span class="Common">.</span><span class="Common">Generic</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Linq</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Reflection</span><span class="Common">;</span><span class="Common">

</span><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">;</span><span class="Common">

</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">class</span><span class="Common"> </span><span class="Common">CreatureMapCreator</span><span class="Common">
</span><span class="Common">{</span><span class="Common">
	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">readonly</span><span class="Common"> </span><span class="Common">Dictionary</span><span class="Common"><</span><span class="Common">string</span><span class="Common">,</span><span class="Common"> </span><span class="Common">Func</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">></span><span class="Common"> </span><span class="Common">factory</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">,</span><span class="Common">]</span><span class="Common"> </span><span class="Common">CreateMap</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">map</span><span class="Common">,</span><span class="Common"> </span><span class="Common">string</span><span class="Common"> </span><span class="Common">separator</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">"</span><span class="Common">\</span><span class="Common">r</span><span class="Common">\</span><span class="Common">n</span><span class="Common">"</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">rows</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">map</span><span class="Common">.</span><span class="Common">Split</span><span class="Common">(</span><span class="Common">new</span><span class="Common">[</span><span class="Common">]</span><span class="Common"> </span><span class="Common">{</span><span class="Common">separator</span><span class="Common">}</span><span class="Common">,</span><span class="Common"> </span><span class="Common">StringSplitOptions</span><span class="Common">.</span><span class="Common">RemoveEmptyEntries</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Select</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Distinct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Count</span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">!</span><span class="Common">=</span><span class="Common"> </span><span class="Common">1</span><span class="Common">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Wrong</span><span class="Common"> </span><span class="Common">test</span><span class="Common"> </span><span class="Common">map</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">map</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">result</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">,</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Specific">
			</span><span class="Specific">{</span><span class="Specific">
				</span><span class="Common">result</span><span class="Common">[</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">y</span><span class="Common">]</span><span class="Common">[</span><span class="Common">x</span><span class="Common">]</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
			</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">result</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">

	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">factory</span><span class="Common">.</span><span class="Common">ContainsKey</span><span class="Common">(</span><span class="Common">name</span><span class="Common">)</span><span class="Common">)</span><span class="Specific"> 
			</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">factory</span><span class="Specific">[</span><span class="Specific">name</span><span class="Specific">]</span><span class="Specific">(</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Assembly</span><span class="Common">
			</span><span class="Common">.</span><span class="Common">GetExecutingAssembly</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">.</span><span class="Common">GetTypes</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">.</span><span class="Common">FirstOrDefault</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Name</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">null</span><span class="Common">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Can</span><span class="Common">'</span><span class="Common">t</span><span class="Common"> </span><span class="Common">find</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">name</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">(</span><span class="Common">ICreature</span><span class="Common">)</span><span class="Common"> </span><span class="Common">Activator</span><span class="Common">.</span><span class="Common">CreateInstance</span><span class="Common">(</span><span class="Common">type</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">


	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">char</span><span class="Common"> </span><span class="Common">c</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific"> </span><span class="Common">=</span><span class="Specific">=</span><span class="Specific"> </span><span class="Specific">'</span><span class="Specific">P</span><span class="Specific">'</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Common">{</span><span class="Specific">
			</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Specific">(</span><span class="Common">"</span><span class="Common">Player</span><span class="Common">"</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific">=</span><span class="Specific"> </span><span class="Specific">'</span><span class="Specific">T</span><span class="Specific">'</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Specific">(</span><span class="Common">"</span><span class="Common">Terrain</span><span class="Common">"</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific">=</span><span class="Specific"> </span><span class="Specific">'</span><span class="Specific">G</span><span class="Specific">'</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Specific">(</span><span class="Common">"</span><span class="Common">Gold</span><span class="Common">"</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
		</span><span class="Common">}</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">c</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">'</span><span class="Specific">S</span><span class="Common">'</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">{</span><span class="Common">
			</span><span class="Common">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Specific">(</span><span class="Specific">"</span><span class="Specific">Sack</span><span class="Specific">"</span><span class="Specific">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific"> </span><span class="Common">=</span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">'</span><span class="Specific">M</span><span class="Specific">'</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Specific">"</span><span class="Specific">Monster</span><span class="Specific">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Specific">c</span><span class="Specific"> </span><span class="Common">=</span><span class="Common">=</span><span class="Specific"> </span><span class="Specific">'</span><span class="Specific"> </span><span class="Specific">'</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">{</span><span class="Specific">
			</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">null</span><span class="Specific">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">wrong</span><span class="Common"> </span><span class="Common">character</span><span class="Common"> </span><span class="Common">for</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">{</span><span class="Common">c</span><span class="Common">}</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">
</span><span class="Common">}</span></td></tr><tr><th>3</th><th>7</th></tr><tr><td><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Collections</span><span class="Common">.</span><span class="Common">Generic</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Linq</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Reflection</span><span class="Common">;</span><span class="Common">

</span><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">;</span><span class="Common">

</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">class</span><span class="Common"> </span><span class="Common">CreatureMapCreator</span><span class="Common">
</span><span class="Common">{</span><span class="Common">
	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">readonly</span><span class="Common"> </span><span class="Common">Dictionary</span><span class="Common"><</span><span class="Common">string</span><span class="Common">,</span><span class="Common"> </span><span class="Common">Func</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">></span><span class="Common"> </span><span class="Common">factory</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">,</span><span class="Common">]</span><span class="Common"> </span><span class="Common">CreateMap</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">map</span><span class="Common">,</span><span class="Common"> </span><span class="Common">string</span><span class="Common"> </span><span class="Common">separator</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">"</span><span class="Common">\</span><span class="Common">r</span><span class="Common">\</span><span class="Common">n</span><span class="Common">"</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">rows</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">map</span><span class="Common">.</span><span class="Common">Split</span><span class="Common">(</span><span class="Common">new</span><span class="Common">[</span><span class="Common">]</span><span class="Common"> </span><span class="Common">{</span><span class="Common">separator</span><span class="Common">}</span><span class="Common">,</span><span class="Common"> </span><span class="Common">StringSplitOptions</span><span class="Common">.</span><span class="Common">RemoveEmptyEntries</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Select</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Distinct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Count</span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">!</span><span class="Common">=</span><span class="Common"> </span><span class="Common">1</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Wrong</span><span class="Common"> </span><span class="Common">test</span><span class="Common"> </span><span class="Common">map</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">map</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">result</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">,</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">result</span><span class="Common">[</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">y</span><span class="Common">]</span><span class="Common">[</span><span class="Common">x</span><span class="Common">]</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">result</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">

	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Specific">
		</span><span class="Specific">/</span><span class="Specific">/</span><span class="Specific"> </span><span class="Specific">Это</span><span class="Specific"> </span><span class="Specific">использование</span><span class="Specific"> </span><span class="Specific">механизма</span><span class="Specific"> </span><span class="Specific">рефлексии</span><span class="Specific">.</span><span class="Specific"> 
		</span><span class="Specific">/</span><span class="Specific">/</span><span class="Specific"> </span><span class="Specific">Ему</span><span class="Specific"> </span><span class="Specific">посвящена</span><span class="Specific"> </span><span class="Specific">одна</span><span class="Specific"> </span><span class="Specific">из</span><span class="Specific"> </span><span class="Specific">последних</span><span class="Specific"> </span><span class="Specific">лекций</span><span class="Specific"> </span><span class="Specific">второй</span><span class="Specific"> </span><span class="Specific">части</span><span class="Specific"> </span><span class="Specific">курса</span><span class="Specific"> </span><span class="Specific">Основы</span><span class="Specific"> </span><span class="Specific">программирования</span><span class="Specific">
		</span><span class="Specific">/</span><span class="Specific">/</span><span class="Specific"> </span><span class="Specific">В</span><span class="Specific"> </span><span class="Specific">обычном</span><span class="Specific"> </span><span class="Specific">коде</span><span class="Specific"> </span><span class="Specific">можно</span><span class="Specific"> </span><span class="Specific">было</span><span class="Specific"> </span><span class="Specific">обойтись</span><span class="Specific"> </span><span class="Specific">без</span><span class="Specific"> </span><span class="Specific">нее</span><span class="Specific">,</span><span class="Specific"> </span><span class="Specific">но</span><span class="Specific"> </span><span class="Specific">нам</span><span class="Specific"> </span><span class="Specific">нужно</span><span class="Specific"> </span><span class="Specific">было</span><span class="Specific"> </span><span class="Specific">написать</span><span class="Specific"> </span><span class="Specific">такой</span><span class="Specific"> </span><span class="Specific">код</span><span class="Specific">,</span><span class="Specific">
		</span><span class="Specific">/</span><span class="Specific">/</span><span class="Specific"> </span><span class="Specific">который</span><span class="Specific"> </span><span class="Specific">работал</span><span class="Specific"> </span><span class="Specific">бы</span><span class="Specific">,</span><span class="Specific"> </span><span class="Specific">даже</span><span class="Specific"> </span><span class="Specific">если</span><span class="Specific"> </span><span class="Specific">вы</span><span class="Specific"> </span><span class="Specific">ещё</span><span class="Specific"> </span><span class="Specific">не</span><span class="Specific"> </span><span class="Specific">создали</span><span class="Specific"> </span><span class="Specific">класс</span><span class="Specific"> </span><span class="Specific">Monster</span><span class="Specific"> </span><span class="Specific">или</span><span class="Specific"> </span><span class="Specific">Gold</span><span class="Specific">.</span><span class="Specific"> 
		</span><span class="Specific">/</span><span class="Specific">/</span><span class="Specific"> </span><span class="Specific">Просто</span><span class="Specific"> </span><span class="Specific">написать</span><span class="Specific"> </span><span class="Specific">new</span><span class="Specific"> </span><span class="Specific">Gold</span><span class="Specific">(</span><span class="Specific">)</span><span class="Specific"> </span><span class="Specific">мы</span><span class="Specific"> </span><span class="Specific">не</span><span class="Specific"> </span><span class="Specific">могли</span><span class="Specific">,</span><span class="Specific"> </span><span class="Specific">потому</span><span class="Specific"> </span><span class="Specific">что</span><span class="Specific"> </span><span class="Specific">это</span><span class="Specific"> </span><span class="Specific">не</span><span class="Specific"> </span><span class="Specific">скомпилировалось</span><span class="Specific"> </span><span class="Specific">бы</span><span class="Specific"> </span><span class="Specific">до</span><span class="Specific"> </span><span class="Specific">создания</span><span class="Specific"> </span><span class="Specific">класса</span><span class="Specific"> </span><span class="Specific">Gold</span><span class="Specific">.</span><span class="Specific">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Specific">!</span><span class="Common">factory</span><span class="Common">.</span><span class="Common">ContainsKey</span><span class="Common">(</span><span class="Common">name</span><span class="Common">)</span><span class="Common">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">var</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Assembly</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">GetExecutingAssembly</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">GetTypes</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">FirstOrDefault</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Name</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">null</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Can</span><span class="Common">'</span><span class="Common">t</span><span class="Common"> </span><span class="Common">find</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">name</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">(</span><span class="Common">ICreature</span><span class="Common">)</span><span class="Common"> </span><span class="Common">Activator</span><span class="Common">.</span><span class="Common">CreateInstance</span><span class="Common">(</span><span class="Common">type</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">


	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">char</span><span class="Common"> </span><span class="Common">c</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Specific">
		</span><span class="Specific">switch</span><span class="Specific"> </span><span class="Common">(</span><span class="Common">c</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Common">'</span><span class="Common">P</span><span class="Common">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Common">return</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">"</span><span class="Common">Player</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Common">'</span><span class="Common">T</span><span class="Common">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Common">return</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">"</span><span class="Common">Terrain</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Common">'</span><span class="Common">G</span><span class="Common">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Common">return</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">"</span><span class="Common">Gold</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Common">'</span><span class="Common">S</span><span class="Common">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Common">return</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">"</span><span class="Common">Sack</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Common">'</span><span class="Common">M</span><span class="Common">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Common">return</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">"</span><span class="Common">Monster</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Common">'</span><span class="Common"> </span><span class="Common">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Common">return</span><span class="Common"> </span><span class="Common">null</span><span class="Common">;</span><span class="Specific">
			</span><span class="Specific">default</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">wrong</span><span class="Common"> </span><span class="Common">character</span><span class="Common"> </span><span class="Common">for</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">{</span><span class="Common">c</span><span class="Common">}</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Common">
	</span><span class="Common">}</span><span class="Specific">
</span><span class="Specific">}</span></td><td><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Collections</span><span class="Common">.</span><span class="Common">Generic</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Linq</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Reflection</span><span class="Common">;</span><span class="Common">

</span><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">;</span><span class="Common">

</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">class</span><span class="Common"> </span><span class="Common">CreatureMapCreator</span><span class="Common">
</span><span class="Common">{</span><span class="Common">
	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">readonly</span><span class="Common"> </span><span class="Common">Dictionary</span><span class="Common"><</span><span class="Common">string</span><span class="Common">,</span><span class="Common"> </span><span class="Common">Func</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">></span><span class="Common"> </span><span class="Common">factory</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">,</span><span class="Common">]</span><span class="Common"> </span><span class="Common">CreateMap</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">map</span><span class="Common">,</span><span class="Common"> </span><span class="Common">string</span><span class="Common"> </span><span class="Common">separator</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">"</span><span class="Common">\</span><span class="Common">r</span><span class="Common">\</span><span class="Common">n</span><span class="Common">"</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">rows</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">map</span><span class="Common">.</span><span class="Common">Split</span><span class="Common">(</span><span class="Common">new</span><span class="Common">[</span><span class="Common">]</span><span class="Common"> </span><span class="Common">{</span><span class="Common">separator</span><span class="Common">}</span><span class="Common">,</span><span class="Common"> </span><span class="Common">StringSplitOptions</span><span class="Common">.</span><span class="Common">RemoveEmptyEntries</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Select</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Distinct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Count</span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">!</span><span class="Common">=</span><span class="Common"> </span><span class="Common">1</span><span class="Common">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Wrong</span><span class="Common"> </span><span class="Common">test</span><span class="Common"> </span><span class="Common">map</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">map</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">result</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">,</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Specific">
			</span><span class="Specific">{</span><span class="Specific">
				</span><span class="Common">result</span><span class="Common">[</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">y</span><span class="Common">]</span><span class="Common">[</span><span class="Common">x</span><span class="Common">]</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
			</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">result</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">

	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">factory</span><span class="Common">.</span><span class="Common">ContainsKey</span><span class="Common">(</span><span class="Common">name</span><span class="Common">)</span><span class="Common">)</span><span class="Specific"> 
			</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">factory</span><span class="Specific">[</span><span class="Specific">name</span><span class="Specific">]</span><span class="Specific">(</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Assembly</span><span class="Common">
			</span><span class="Common">.</span><span class="Common">GetExecutingAssembly</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">.</span><span class="Common">GetTypes</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">.</span><span class="Common">FirstOrDefault</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Name</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">null</span><span class="Common">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Can</span><span class="Common">'</span><span class="Common">t</span><span class="Common"> </span><span class="Common">find</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">name</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">(</span><span class="Common">ICreature</span><span class="Common">)</span><span class="Common"> </span><span class="Common">Activator</span><span class="Common">.</span><span class="Common">CreateInstance</span><span class="Common">(</span><span class="Common">type</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">


	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">char</span><span class="Common"> </span><span class="Common">c</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Common">(</span><span class="Common">c</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific">=</span><span class="Specific"> </span><span class="Common">'</span><span class="Common">P</span><span class="Common">'</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">return</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">"</span><span class="Common">Player</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific">=</span><span class="Specific"> </span><span class="Common">'</span><span class="Common">T</span><span class="Common">'</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">return</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">"</span><span class="Common">Terrain</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific">=</span><span class="Specific"> </span><span class="Common">'</span><span class="Common">G</span><span class="Common">'</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">return</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">"</span><span class="Common">Gold</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific">=</span><span class="Specific"> </span><span class="Common">'</span><span class="Common">S</span><span class="Common">'</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">return</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">"</span><span class="Common">Sack</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific">=</span><span class="Specific"> </span><span class="Common">'</span><span class="Common">M</span><span class="Common">'</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">return</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">"</span><span class="Common">Monster</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific">=</span><span class="Specific"> </span><span class="Common">'</span><span class="Common"> </span><span class="Common">'</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">return</span><span class="Common"> </span><span class="Common">null</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">wrong</span><span class="Common"> </span><span class="Common">character</span><span class="Common"> </span><span class="Common">for</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">{</span><span class="Common">c</span><span class="Common">}</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">
</span><span class="Common">}</span></td></tr><tr><th>3</th><th>6</th></tr><tr><td><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Collections</span><span class="Common">.</span><span class="Common">Generic</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Linq</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Reflection</span><span class="Common">;</span><span class="Common">

</span><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">;</span><span class="Common">

</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">class</span><span class="Common"> </span><span class="Common">CreatureMapCreator</span><span class="Common">
</span><span class="Common">{</span><span class="Common">
	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">readonly</span><span class="Common"> </span><span class="Common">Dictionary</span><span class="Common"><</span><span class="Common">string</span><span class="Common">,</span><span class="Common"> </span><span class="Common">Func</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">></span><span class="Common"> </span><span class="Common">factory</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">,</span><span class="Common">]</span><span class="Common"> </span><span class="Common">CreateMap</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">map</span><span class="Common">,</span><span class="Common"> </span><span class="Common">string</span><span class="Common"> </span><span class="Common">separator</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">"</span><span class="Common">\</span><span class="Common">r</span><span class="Common">\</span><span class="Common">n</span><span class="Common">"</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">rows</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">map</span><span class="Common">.</span><span class="Common">Split</span><span class="Common">(</span><span class="Common">new</span><span class="Common">[</span><span class="Common">]</span><span class="Common"> </span><span class="Common">{</span><span class="Common">separator</span><span class="Common">}</span><span class="Common">,</span><span class="Common"> </span><span class="Common">StringSplitOptions</span><span class="Common">.</span><span class="Common">RemoveEmptyEntries</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Select</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Distinct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Count</span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">!</span><span class="Common">=</span><span class="Common"> </span><span class="Common">1</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Wrong</span><span class="Common"> </span><span class="Common">test</span><span class="Common"> </span><span class="Common">map</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">map</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">result</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">,</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">result</span><span class="Common">[</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">y</span><span class="Common">]</span><span class="Common">[</span><span class="Common">x</span><span class="Common">]</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">result</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">

	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">/</span><span class="Common">/</span><span class="Specific"> </span><span class="Specific">Это</span><span class="Specific"> </span><span class="Specific">использование</span><span class="Specific"> </span><span class="Specific">механизма</span><span class="Specific"> </span><span class="Specific">рефлексии</span><span class="Specific">.</span><span class="Specific"> 
		</span><span class="Common">/</span><span class="Common">/</span><span class="Specific"> </span><span class="Specific">Ему</span><span class="Specific"> </span><span class="Specific">посвящена</span><span class="Specific"> </span><span class="Specific">одна</span><span class="Specific"> </span><span class="Specific">из</span><span class="Specific"> </span><span class="Specific">последних</span><span class="Specific"> </span><span class="Specific">лекций</span><span class="Specific"> </span><span class="Specific">второй</span><span class="Specific"> </span><span class="Specific">части</span><span class="Specific"> </span><span class="Specific">курса</span><span class="Specific"> </span><span class="Specific">Основы</span><span class="Specific"> </span><span class="Specific">программирования</span><span class="Specific">
		</span><span class="Common">/</span><span class="Common">/</span><span class="Specific"> </span><span class="Specific">В</span><span class="Specific"> </span><span class="Specific">обычном</span><span class="Specific"> </span><span class="Specific">коде</span><span class="Specific"> </span><span class="Specific">можно</span><span class="Specific"> </span><span class="Specific">было</span><span class="Specific"> </span><span class="Specific">обойтись</span><span class="Specific"> </span><span class="Specific">без</span><span class="Specific"> </span><span class="Specific">нее</span><span class="Specific">,</span><span class="Specific"> </span><span class="Specific">но</span><span class="Specific"> </span><span class="Specific">нам</span><span class="Specific"> </span><span class="Specific">нужно</span><span class="Specific"> </span><span class="Specific">было</span><span class="Specific"> </span><span class="Specific">написать</span><span class="Specific"> </span><span class="Specific">такой</span><span class="Specific"> </span><span class="Specific">код</span><span class="Specific">,</span><span class="Specific">
		</span><span class="Specific">/</span><span class="Specific">/</span><span class="Specific"> </span><span class="Specific">который</span><span class="Specific"> </span><span class="Specific">работал</span><span class="Specific"> </span><span class="Specific">бы</span><span class="Specific">,</span><span class="Specific"> </span><span class="Specific">даже</span><span class="Specific"> </span><span class="Specific">если</span><span class="Specific"> </span><span class="Specific">вы</span><span class="Specific"> </span><span class="Common">ещё</span><span class="Specific"> </span><span class="Specific">не</span><span class="Specific"> </span><span class="Specific">создали</span><span class="Specific"> </span><span class="Specific">класс</span><span class="Specific"> </span><span class="Specific">Monster</span><span class="Specific"> </span><span class="Specific">или</span><span class="Specific"> </span><span class="Specific">Gold</span><span class="Specific">.</span><span class="Specific"> 
		</span><span class="Common">/</span><span class="Common">/</span><span class="Specific"> </span><span class="Specific">Просто</span><span class="Specific"> </span><span class="Specific">написать</span><span class="Specific"> </span><span class="Specific">new</span><span class="Specific"> </span><span class="Specific">Gold</span><span class="Specific">(</span><span class="Specific">)</span><span class="Specific"> </span><span class="Specific">мы</span><span class="Specific"> </span><span class="Specific">не</span><span class="Specific"> </span><span class="Specific">могли</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">потому</span><span class="Specific"> </span><span class="Specific">что</span><span class="Specific"> </span><span class="Specific">это</span><span class="Specific"> </span><span class="Specific">не</span><span class="Specific"> </span><span class="Specific">скомпилировалось</span><span class="Specific"> </span><span class="Specific">бы</span><span class="Specific"> </span><span class="Specific">до</span><span class="Specific"> </span><span class="Specific">создания</span><span class="Specific"> </span><span class="Specific">класса</span><span class="Specific"> </span><span class="Specific">Gold</span><span class="Specific">.</span><span class="Specific">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">!</span><span class="Common">factory</span><span class="Common">.</span><span class="Common">ContainsKey</span><span class="Common">(</span><span class="Common">name</span><span class="Common">)</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">{</span><span class="Common">
			</span><span class="Common">var</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Assembly</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">GetExecutingAssembly</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">GetTypes</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">FirstOrDefault</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Name</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">null</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Can</span><span class="Common">'</span><span class="Common">t</span><span class="Common"> </span><span class="Common">find</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">name</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">(</span><span class="Common">ICreature</span><span class="Common">)</span><span class="Common"> </span><span class="Common">Activator</span><span class="Common">.</span><span class="Common">CreateInstance</span><span class="Common">(</span><span class="Common">type</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Common">

		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">


	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">char</span><span class="Common"> </span><span class="Common">c</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Specific">
		</span><span class="Specific">switch</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Common">{</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Specific">'</span><span class="Specific">P</span><span class="Specific">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Specific">(</span><span class="Common">"</span><span class="Common">Player</span><span class="Common">"</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Specific">'</span><span class="Specific">T</span><span class="Specific">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Specific">(</span><span class="Common">"</span><span class="Common">Terrain</span><span class="Common">"</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Specific">'</span><span class="Specific">G</span><span class="Specific">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Specific">(</span><span class="Common">"</span><span class="Common">Gold</span><span class="Common">"</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Specific">'</span><span class="Specific">S</span><span class="Specific">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Specific">(</span><span class="Common">"</span><span class="Common">Sack</span><span class="Common">"</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Specific">'</span><span class="Specific">M</span><span class="Specific">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Specific">(</span><span class="Common">"</span><span class="Common">Monster</span><span class="Common">"</span><span class="Specific">)</span><span class="Common">;</span><span class="Specific">
			</span><span class="Specific">case</span><span class="Specific"> </span><span class="Common">'</span><span class="Common"> </span><span class="Common">'</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Common">return</span><span class="Common"> </span><span class="Common">null</span><span class="Common">;</span><span class="Specific">
			</span><span class="Specific">default</span><span class="Specific">:</span><span class="Specific">
				</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">wrong</span><span class="Common"> </span><span class="Common">character</span><span class="Common"> </span><span class="Common">for</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">{</span><span class="Common">c</span><span class="Common">}</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">
</span><span class="Common">}</span></td><td><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Collections</span><span class="Common">.</span><span class="Common">Generic</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Linq</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Reflection</span><span class="Common">;</span><span class="Common">

</span><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">;</span><span class="Common">

</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">class</span><span class="Common"> </span><span class="Common">CreatureMapCreator</span><span class="Common">
</span><span class="Common">{</span><span class="Common">
	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">readonly</span><span class="Common"> </span><span class="Common">Dictionary</span><span class="Common"><</span><span class="Common">string</span><span class="Common">,</span><span class="Common"> </span><span class="Common">Func</span><span class="Common"><</span><span class="Common">ICreature</span><span class="Common">></span><span class="Common">></span><span class="Common"> </span><span class="Common">factory</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

	</span><span class="Common">public</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">,</span><span class="Common">]</span><span class="Common"> </span><span class="Common">CreateMap</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">map</span><span class="Common">,</span><span class="Common"> </span><span class="Common">string</span><span class="Common"> </span><span class="Common">separator</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">"</span><span class="Common">\</span><span class="Common">r</span><span class="Common">\</span><span class="Common">n</span><span class="Common">"</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">rows</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">map</span><span class="Common">.</span><span class="Common">Split</span><span class="Common">(</span><span class="Common">new</span><span class="Common">[</span><span class="Common">]</span><span class="Common"> </span><span class="Common">{</span><span class="Common">separator</span><span class="Common">}</span><span class="Common">,</span><span class="Common"> </span><span class="Common">StringSplitOptions</span><span class="Common">.</span><span class="Common">RemoveEmptyEntries</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Select</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Distinct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">.</span><span class="Common">Count</span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">!</span><span class="Common">=</span><span class="Common"> </span><span class="Common">1</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Wrong</span><span class="Common"> </span><span class="Common">test</span><span class="Common"> </span><span class="Common">map</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">map</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">var</span><span class="Common"> </span><span class="Common">result</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common">[</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">,</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">[</span><span class="Common">0</span><span class="Common">]</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common"><</span><span class="Common"> </span><span class="Common">rows</span><span class="Common">.</span><span class="Common">Length</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
			</span><span class="Common">result</span><span class="Common">[</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">rows</span><span class="Common">[</span><span class="Common">y</span><span class="Common">]</span><span class="Common">[</span><span class="Common">x</span><span class="Common">]</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">result</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">

	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureByTypeName</span><span class="Common">(</span><span class="Common">string</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Common">
		</span><span class="Common">/</span><span class="Common">/</span><span class="Specific"> </span><span class="Specific">Какой</span><span class="Specific">-</span><span class="Specific">то</span><span class="Specific"> </span><span class="Specific">комментарий</span><span class="Specific">
		</span><span class="Common">/</span><span class="Common">/</span><span class="Specific"> </span><span class="Specific">И</span><span class="Specific"> </span><span class="Specific">ещё</span><span class="Specific">.</span><span class="Specific">.</span><span class="Specific">
		</span><span class="Common">/</span><span class="Common">/</span><span class="Specific"> </span><span class="Specific">И</span><span class="Specific"> </span><span class="Common">ещё</span><span class="Specific"> </span><span class="Specific">комментарий</span><span class="Specific">
		</span><span class="Common">/</span><span class="Common">/</span><span class="Specific"> </span><span class="Specific">Пожалуй</span><span class="Common">,</span><span class="Specific"> </span><span class="Specific">перепишу</span><span class="Specific"> </span><span class="Specific">один</span><span class="Specific"> </span><span class="Specific">метод</span><span class="Specific">
		</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">!</span><span class="Common">factory</span><span class="Common">.</span><span class="Common">ContainsKey</span><span class="Common">(</span><span class="Common">name</span><span class="Common">)</span><span class="Common">)</span><span class="Common">
		</span><span class="Common">{</span><span class="Common">
			</span><span class="Common">var</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Assembly</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">GetExecutingAssembly</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">GetTypes</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">.</span><span class="Common">FirstOrDefault</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Name</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">name</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">type</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">null</span><span class="Common">)</span><span class="Common">
				</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">Can</span><span class="Common">'</span><span class="Common">t</span><span class="Common"> </span><span class="Common">find</span><span class="Common"> </span><span class="Common">type</span><span class="Common"> </span><span class="Common">'</span><span class="Common">{</span><span class="Common">name</span><span class="Common">}</span><span class="Common">'</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
			</span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">(</span><span class="Common">)</span><span class="Common"> </span><span class="Common">=</span><span class="Common">></span><span class="Common"> </span><span class="Common">(</span><span class="Common">ICreature</span><span class="Common">)</span><span class="Common"> </span><span class="Common">Activator</span><span class="Common">.</span><span class="Common">CreateInstance</span><span class="Common">(</span><span class="Common">type</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Common">

		</span><span class="Common">return</span><span class="Common"> </span><span class="Common">factory</span><span class="Common">[</span><span class="Common">name</span><span class="Common">]</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">}</span><span class="Common">


	</span><span class="Common">private</span><span class="Common"> </span><span class="Common">static</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">CreateCreatureBySymbol</span><span class="Common">(</span><span class="Common">char</span><span class="Common"> </span><span class="Common">c</span><span class="Common">)</span><span class="Common">
	</span><span class="Common">{</span><span class="Specific">
		</span><span class="Specific">List</span><span class="Specific"><</span><span class="Specific">string</span><span class="Specific">></span><span class="Specific"> </span><span class="Specific">names</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific"> </span><span class="Specific">new</span><span class="Specific"> </span><span class="Specific">List</span><span class="Specific"><</span><span class="Specific">string</span><span class="Specific">></span><span class="Specific"> </span><span class="Common">{</span><span class="Common">"</span><span class="Common">Player</span><span class="Common">"</span><span class="Specific">,</span><span class="Specific"> </span><span class="Common">"</span><span class="Common">Terrain</span><span class="Common">"</span><span class="Specific">,</span><span class="Specific"> </span><span class="Common">"</span><span class="Common">Gold</span><span class="Common">"</span><span class="Specific">,</span><span class="Specific"> </span><span class="Common">"</span><span class="Common">Sack</span><span class="Common">"</span><span class="Specific">,</span><span class="Specific"> </span><span class="Common">"</span><span class="Common">Monster</span><span class="Common">"</span><span class="Specific">}</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific">=</span><span class="Specific"> </span><span class="Common">'</span><span class="Common"> </span><span class="Common">'</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">return</span><span class="Common"> </span><span class="Common">null</span><span class="Common">;</span><span class="Specific">
		</span><span class="Specific">}</span><span class="Specific">

		</span><span class="Specific">var</span><span class="Specific"> </span><span class="Specific">name</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific"> </span><span class="Specific">names</span><span class="Specific">.</span><span class="Specific">FirstOrDefault</span><span class="Specific">(</span><span class="Specific">s</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific">></span><span class="Specific"> </span><span class="Specific">s</span><span class="Specific">.</span><span class="Specific">StartsWith</span><span class="Specific">(</span><span class="Specific">new</span><span class="Specific"> </span><span class="Specific">string</span><span class="Specific">(</span><span class="Specific">c</span><span class="Specific">,</span><span class="Specific"> </span><span class="Specific">1</span><span class="Specific">)</span><span class="Specific">)</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
		</span><span class="Specific">if</span><span class="Specific"> </span><span class="Specific">(</span><span class="Specific">name</span><span class="Specific"> </span><span class="Specific">=</span><span class="Specific">=</span><span class="Specific"> </span><span class="Specific">null</span><span class="Specific">)</span><span class="Specific">
		</span><span class="Specific">{</span><span class="Specific">
			</span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">"</span><span class="Common">wrong</span><span class="Common"> </span><span class="Common">character</span><span class="Common"> </span><span class="Common">for</span><span class="Common"> </span><span class="Common">ICreature</span><span class="Common"> </span><span class="Common">{</span><span class="Common">c</span><span class="Common">}</span><span class="Common">"</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
		</span><span class="Common">}</span><span class="Specific">

		</span><span class="Specific">return</span><span class="Specific"> </span><span class="Specific">CreateCreatureByTypeName</span><span class="Specific">(</span><span class="Specific">name</span><span class="Specific">)</span><span class="Specific">;</span><span class="Specific">
	</span><span class="Common">}</span><span class="Common">
</span><span class="Common">}</span></td></tr><tr><th>4</th><th>8</th></tr><tr><td><span class="Specific">using</span><span class="Specific"> </span><span class="Specific">System</span><span class="Specific">.</span><span class="Specific">Drawing</span><span class="Specific">;</span><span class="Specific">

</span><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">;</span><span class="Common">

</span><span class="Common">public</span><span class="Common"> </span><span class="Common">class</span><span class="Specific"> </span><span class="Specific">CreatureAnimation</span><span class="Specific">
</span><span class="Common">{</span><span class="Common">
	</span><span class="Common">public</span><span class="Specific"> </span><span class="Specific">CreatureCommand</span><span class="Specific"> </span><span class="Specific">Command</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">public</span><span class="Specific"> </span><span class="Specific">ICreature</span><span class="Specific"> </span><span class="Specific">Creature</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">public</span><span class="Specific"> </span><span class="Specific">Point</span><span class="Specific"> </span><span class="Specific">Location</span><span class="Common">;</span><span class="Specific">
	</span><span class="Specific">public</span><span class="Specific"> </span><span class="Specific">Point</span><span class="Specific"> </span><span class="Specific">TargetLogicalLocation</span><span class="Specific">;</span><span class="Specific">
</span><span class="Common">}</span></td><td><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">;</span><span class="Common">

</span><span class="Common">public</span><span class="Common"> </span><span class="Common">class</span><span class="Specific"> </span><span class="Specific">CreatureCommand</span><span class="Specific">
</span><span class="Common">{</span><span class="Common">
	</span><span class="Common">public</span><span class="Specific"> </span><span class="Specific">int</span><span class="Specific"> </span><span class="Specific">DeltaX</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">public</span><span class="Specific"> </span><span class="Specific">int</span><span class="Specific"> </span><span class="Specific">DeltaY</span><span class="Common">;</span><span class="Common">
	</span><span class="Common">public</span><span class="Specific"> </span><span class="Specific">ICreature</span><span class="Specific"> </span><span class="Specific">TransformTo</span><span class="Common">;</span><span class="Common">
</span><span class="Common">}</span></td></tr></table></pre></body></html>
